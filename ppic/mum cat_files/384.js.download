(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[384],{1970:function(e,t,n){"use strict";var a;n.d(t,"e",function(){return a}),function(e){e[e.Add=0]="Add",e[e.Update=1]="Update",e[e.Remove=2]="Remove"}(a||(a={}))},2868:function(e,t,n){"use strict";n.r(t),n.d(t,"resourceKey",function(){return b});var a=n(0),i=n(1970),r=n(1295),o=n(490),s=n(338),c=n(57),d=n(497),l=n(1324),u=n(1918),f=n(2050),p=n(1546),m=n(302),_=!n(15).e.isActivated("E435AB9B-59B2-49CC-9FBF-AC1039571D05","05/12/2022","Disable unnecessary resources for unuath users"),h=function(e){function t(t,n){var a=e.call(this,t,n)||this;return a._itemsStore=n.itemsStore,a._urlDataSource=n.urlDataSource,a._vaultDataSource=n.vaultDataSource,a._identityDataSource=n.identityDataSource,a._pushChannelProvider=n.pushChannelProvider,a._updateQuota=n.updateQuota,a._isOneDriveWinApp=Object(d.e)(),a}return Object(a.__extends)(t,e),t.prototype.isEnabled=function(){return Object(c.isFeatureEnabled)(c.EnablePushChannelAutoRefresh)&&this.isAuthValid()},t.prototype.isAuthValid=function(){return!_||this._identityDataSource.getIdentity().type!==s.e.anonymous},t.prototype.onGetChanges=function(e){},t.prototype.createSubscription=function(e,t,n){},t.prototype.onSubscriptionCreated=function(){},t.prototype.deleteSubscription=function(e){},t.prototype.getChangesHeaders=function(){var e;if(this._isOneDriveWinApp&&this._vaultDataSource.isVaultOpen().peek())return(e={}).Prefer="Include-Feature=Vault",e},t.prototype.parseChangesResponse=function(e){for(var t=[],n=!1,a=0,i=e.value;a<i.length;a++){var r=i[a];r.vault&&(n=!0),"!0"===r.id.substring(r.id.length-2)&&(r.id=this._urlDataSource.getDefaultRootItemId());var o=null;r.parentReference&&(o=r.parentReference.id)&&"!0"===o.substring(o.length-2)&&(o=this._urlDataSource.getDefaultRootItemId()),o||this._pushChannelProvider.log(u.n.ItemAutoRefreshDataSource,"Invalid parent resource id for item",r);var s=null;if(r.eTag&&"function"==typeof atob)try{s=atob(r.eTag.substr(1))}catch(e){this._pushChannelProvider.log(u.n.ItemAutoRefreshDataSource,"Failed to decode eTag for item",r)}t.push({deleted:!!r.deleted,id:r.id,eTag:s,parentId:o,dateModified:r.lastModifiedDateTime})}return n&&this._updateQuota(n),t},t.prototype.onMessage=function(e){var t,n,a=[],r=this._urlDataSource.getDefaultRootItemId();e.sort(function(e,t){return e.parentId===r?1:t.parentId===r?-1:0});for(var o=0;o<e.length;o++){var s=e[o];this._pushChannelProvider.log(u.n.ItemAutoRefreshDataSource,"onMessage",s);var c=this._urlDataSource.getKey(((t={}).id=s.id,t)),d=this._itemsStore.getItem(c);if(d){var l=d();if(this._pushChannelProvider.log(u.n.ItemAutoRefreshDataSource,"Changed Item",l),l.eTag===s.eTag||s.deleted&&""===l.eTag){for(var f=o+1;f<e.length;f++)if(e[f].id===s.parentId){this._pushChannelProvider.log(u.n.ItemAutoRefreshDataSource,"Removing parent to prevent a refresh"),e.splice(f,1);break}}else s.deleted?a.push({type:i.e.Remove,parentKey:l.parentKey,item:l}):a.push({type:i.e.Update,parentKey:l.parentKey,item:l})}else s.parentId&&(c=this._urlDataSource.getKey(((n={}).id=s.parentId,n)),a.push({type:i.e.Add,parentKey:c}))}return a},t.dependencies=Object(a.__assign)(Object(a.__assign)({},r.e.dependencies),{itemsStore:l.e,urlDataSource:m.ge,vaultDataSource:m.Se,pushChannelProvider:f.e,updateQuota:p.e,identityDataSource:m.D}),t}(r.e);t.default=h;var b=Object(o.r)("ItemAutoRefreshDataSource",h)}}]);