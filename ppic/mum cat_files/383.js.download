(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[383],{2863:function(e,t,n){"use strict";n.r(t),n.d(t,"resourceKey",function(){return v});var a=n(0),i=n(338),r=n(228),o=n(242),s=n(490),c=n(1454),d=n(258),l=n(57),u=n(497),f=n(7),p=n(33),m=n(302),_=n(45),h=n(15),b=!h.e.isActivated("75843FC5-8F0A-4925-BB0B-AA5FCE46444C","02/07/2022","Enable various thumbnail fixes in ItemResultProcessor and addon-graph ItemThumbnailControl"),g=function(){function e(e,t){this._identityDataSource=t.identityDataSource,this._navigation=t.navigation,this._urlCache=new Map,this._vroomDataRequestor=t.vroomDataRequestor}return e.prototype.getDownloadUrl=function(e,t){void 0===t&&(t={});var n=this._urlCache;if(!t.forceRefresh){var i=n.get(e.key)||{},r=i.url,s=i.time;if(r&&s<Date.now()-27e5)return o.n.wrap(r)}var c=this._getAuthKey(),l=this.getItemUrl(e,t),u=t.headers||{};if(c){var f=d.get("BadgerAuth");f&&(u=Object(a.__assign)(Object(a.__assign)({},u),{Authorization:"Badger "+f}))}var p="itemDownloadUrl";return t.apiName&&(p="".concat(t.apiName,".").concat(p)),this._vroomDataRequestor.send({apiName:p,path:"".concat(l,"?select=id,@content.downloadUrl").concat(c?"&".concat("authkey","=").concat(c):""),needsAuthorization:!c,headers:u,qosExtraData:t.qosExtraData,useAuthorizationHeaders:!h.e.isActivated("BCFD327B-F553-4D0D-95B2-2A813398A3B0","10/21/2021","Use auth header in single-file download")}).then(function(t){var a=t["@content.downloadUrl"];if(!a)throw new _.e({code:"NoDownloadUrl",message:"Vroom response did not contain download URL"});return n.set(e.key,{url:a,time:Date.now()}),a})},e.prototype.getDownloadUrlSync=function(e,t){var n=this.getItemUrl(e,t),a=this._getAuthKey();return n&&a?"".concat(n,"/content?authkey=").concat(a):void 0},e.prototype.getAuthenticationParams=function(e){var t,n=this._getAuthKey();return n?o.n.resolve(((t={}).authkey=n,t)):this._identityDataSource.getSessionToken().then(function(e){var t=e.accessToken,n=e.proofToken,a={};return t&&(a.access_token=decodeURIComponent(t)),n&&(a.prooftoken=decodeURIComponent(n)),a})},e.prototype.getDriveUrl=function(e,t){void 0===t&&(t={});var n=t.useDirectEndpoint,a=void 0!==n&&n,i=t.apiVersion,r=void 0===i?"v1.0":i,o=this._getGraphFacet(e);return this._getDriveUrl(o,a,r)},e.prototype.getItemUrl=function(e,t){void 0===t&&(t={});var n=t.useDirectEndpoint,a=void 0!==n&&n,i=t.isPath,r=void 0!==i&&i,o=t.apiVersion,s=void 0===o?"v1.0":o,c=this._getGraphFacet(e),d=this._getDriveUrl(c,a,s);return"".concat(d,"/items/").concat(encodeURIComponent(c.itemId)).concat(r?":":"")},e.prototype.getAccessToken=function(e){},e.prototype.refreshAccessToken=function(e,t){return void 0===t&&(t={}),b?this._identityDataSource.getSessionToken():o.n.resolve(void 0)},e.prototype._getAuthKey=function(){return this._identityDataSource.getIdentity().type===i.e.anonymous&&this._navigation.viewParams.authkey},e.prototype._getGraphFacet=function(e){var t=e.graph;if(t)return t;var n=Object(f.y)(e.key);return{itemId:n.id,driveId:n.cid}},e.prototype._getDriveUrl=function(e,t,n){var a=t?Object(p.c)({apiVersion:n,driveId:e.driveId}):!Object(l.isFeatureEnabled)(l.UseNewShareDialog)||Object(u.e)()&&!Object(l.isFeatureEnabled)(l.UseNewShareDialogForWinApp)?"https://graph.microsoft.com/v1.0":"https://graph.microsoft.com/beta";return"".concat(a,"/drives/").concat(encodeURIComponent(e.driveId))},e.dependencies={identityDataSource:m.D,navigation:r.e,vroomDataRequestor:c.e},e}();t.default=g;var v=Object(s.r)("GraphDataSource",g)}}]);