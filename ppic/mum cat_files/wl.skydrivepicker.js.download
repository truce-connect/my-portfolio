(function(){var sg="download",Zd="interface_method",Kb="WL.Internal.jsonp.",me=2000,Ed="Application",Wf="Authorization",Xf="body",ne="json_body",De="callback",mb="code",Fd="Content-Type",Xe="element",jb="error",ae="error_description",Ee="file_name",oe="file_input",be="file_output",Ec="request_headers",wc="response_headers",Fe="Location",Ye="logging",bb="message",lf="method",pe="overwrite",xc="rename",Yf="path",yc="percentageComplete",mf="Prefer",nf="pretty",Zc="respond-async",of="result",pd="save_scenario",Gd="SDK-Version",pf="status",Id="http_status",Hd="return_ssl_resources",Jd="stream_input",Ze="tracing",Ge="use_vroom_api",Lc="X-RequestStats",qf="error",Mc=202,ad=201,He=200,lc=500,Ie="success",qd="suppress_redirects",mc="suppress_response_codes",bd="x_http_live_library",Ef=0,rd=1,p="access_token",zg="appstate",Ag="authentication_key";AK_AUTH_TOKEN="authentication_token",(AK_CLIENT_ID="client_id",(AK_DISPLAY="display",(AK_CODE="code",(AK_ERROR="error",(AK_ERROR_DESC="error_description",(AK_EXPIRES="expires",(AK_EXPIRES_IN="expires_in",(AK_ITEMID="item_id",(AK_LOCALE="locale",(AK_OWNER_CID="owner_cid",(AK_REDIRECT_URI="redirect_uri",(AK_RESPONSE="response",(AK_RESPONSE_TYPE="response_type",(AK_REQUEST_TS="request_ts",(AK_RESOURCEID="resource_id",(AK_SCOPE="scope",(AK_SESSION="session",(AK_SECURE_COOKIE="secure_cookie",(AK_STATE="state",AK_STATUS="status")))))))))))))))))));var Vf=[p,AK_AUTH_TOKEN,AK_SCOPE,AK_EXPIRES_IN,AK_EXPIRES],tg="connected",Ff="notConnected",ug="unchecked",Ig="unknown",Bg="expiring",Hg="expired",Gf="live-sdk-upload",bf="live-sdk-download",Ng="appId",ig="channelUrl",Cg="wl_auth",jg="wl_upload",wg="page",kg="touch",vg="none",rf="none",tf="auth.login",df="auth.logout",Vc="auth.sessionChange",fd="auth.statusChange",xb="wl.log",re="access_denied",dd="connection_failed",Le="invalid_cookie",Ld="invalid_request",sf="request_canceled",k="request_failed",Zf="timed_out",Oe="unknown_user",S="user_canceled",Oc="METHOD: Failed to get the required user permission to perform this operation.",Pc="The request could not be completed due to browser issues.",Qc="The request could not be completed due to browser limitations.",bc="The request could not be completed since the browser or browser version is not supported.",E="Callback has thrown an exception. Exception message: MESSAGE",fb="METHOD: The operation has been canceled.",Fc="The 'wl_auth' cookie is not valid.",oc="The 'wl_auth' cookie has been modified incorrectly. Ensure that the redirect URI only modifies sub-keys for values received from the OAuth endpoint.",Wb="The 'wl_auth' cookie has multiple values. Ensure that the redirect URI specifies a cookie domain and path when setting cookies.",td="METHOD: The input property 'PARAM' does not reference a valid DOM element.",P="METHOD: An exception was received for EVENT. Detail: MESSAGE",ud="METHOD: The WL object must be initialized with WL.init() prior to invoking this method.",J="A connection to the server could not be established.",hc="The user could not be identified.",vd="METHOD: Failed to get upload_location of the resource.",ed="The pending login request has been canceled.",cc="Logging out the user is not supported in current session because the user is logged in with a Microsoft account on this computer. To logout, the user may quit the app or log out from the computer.",Sc="METHOD: The input value for parameter/property 'PARAM' is not valid.",Tc="METHOD: The input parameter/property 'PARAM' must be included.",ic="METHOD: The type of the provided value for the input parameter/property 'PARAM' is not valid.",d="METHOD: There is a pending METHOD request, the current call will be ignored.",Sb=d.replace(/METHOD/g,ib),Fb=d.replace(/METHOD/g,ab),Tb=d.replace(/METHOD/g,gb),dc="METHOD: The input property 'redirect_uri' is required if the value of the 'response_type' property is 'code'.",Nb="WL.init: The redirect_uri value should be the same as the value of 'Redirect Domain' of your registered app. It must begin with 'http://' or 'https://'.",Xb="METHOD: The api call is not supported on this platform.",Cb="WL.init: The response_type value 'code' is not supported on this platform.",Ne="METHOD: The input property 'redirect_uri' must use https: to match the scheme of the current page.",Uc="The auth request is timed out.",wd="The popup is closed without receiving consent.",ef=0,Ic=1,Xc=2,Pe=3,Kf="GET",wf="POST",Lf="PUT",Se="DELETE",uf="COPY",vf="MOVE",ab="WL.fileDialog",ag="WL.api",ue="WL.download",Mf="WL.init",ib="WL.login",lg="WL.ui",gb="WL.upload",hd=30000,Ug="METHOD",Vg="PARAM",md="onSuccess",Sd="onError",Yc="onProgress",og="redirect_type",Te="auth",fe="upload",Ue="code",xe="token",f="https:",z="http:",xg="wl.signin",bg="wl.skydrive",Td="wl.skydrive_update",gf=/\s|,/,sb="boolean",Pg="dom",u="function",vb="number",Eg="object",Pf="properties",wb="string",Ve="string_or_array",pb="undefined",Qg="url",qg="name",Bf="element",dg="brand",rg="type",Ud="sign_in_text",Bd="sign_out_text",eg="theme",ye="onloggedin",ie="onloggedout",Cf="onerror",We="messenger",zf="hotmail",hf="skydrive",Af="windows",he="windowslive",pg="none",yb="signin",Xd=yb,ke="login",Cd="connect",Wd="custom",je="blue",Vd="white",Qf="id",Tf="onedrive_api",gg="auth_server",kf="apiservice_uri",Uf="skydrive_uri",Fg="sdk_root",Rg="wl_trace",ge=new RegExp("^\\w+\\.\\w+:\\w+[\\|\\w+]+:([\\w]+\\!\\d+)(?:\\!(.+))*");function i(a,b){return a&&b?a.toLowerCase()===b.toLowerCase():a===b}function l(a){return a==null||a===""}var A="0000000000000000";function w(b,d){var c=d||{};if(b!=null)for(var a in b)c[a]=b[a];return c}function e(b,a){return function(){if(typeof a===u)return a.apply(b,arguments)}}function C(a,g,d){d=d||"[WL]";a=d+a;var c=window;if(c.debugLogger)c.debugLogger.push(a);var b=c.console;if(b&&b.log)switch(g){case "warning":b.warn(a);break;case "error":b.error(a);break;default:b.log(a)}var f=c.opera;if(f)f.postError(a);var e=c.debugService;if(e)e.trace(a)}function zb(a){if(wl_app._traceEnabled)C(a)}if(window.WL&&WL.Internal){WL.Internal.trace=zb;WL.Internal.log=b}function Ab(a){w(B(a),this)}Ab.prototype={toString:function(){var a=this,b=(a.scheme!=""?a.scheme+"//":"")+a.host+(a.port!=""?":"+a.port:"")+a.path;return b},resolve:function(){var a=this;if(a.scheme==""){var b=window.location.port,c=window.location.host;a.scheme=window.location.protocol;a.host=c.split(":")[0];a.port=b!=null?b:"";if(a.path.charAt(0)!="/")a.path=U(a.host,window.location.href,a.path)}}};function B(d){var g=d.indexOf(f)==0?f:d.indexOf(z)==0?z:"",n="",o="",h;if(g!="")var a=d.substring(g.length+2),j=c(a.indexOf("/")),l=c(a.indexOf("\\")),k=c(a.indexOf("?")),m=c(a.indexOf("#")),b=Y(Math.min(j,l,k,m)),i=b>0?a.substring(0,b):a,e=i.split(":"),n=e[0],o=e.length>1?e[1]:"",h=b>0?a.substring(b):"";else h=d;return {scheme:g,host:n,port:o,path:h}}function c(a){if(a==-1)return Number.POSITIVE_INFINITY;return a}function Y(a){if(a==Number.POSITIVE_INFINITY)return -1;return a}function qb(a){return B(a.toLowerCase()).host}function U(e,b,h){var d=function(a,c){charIdx=b.indexOf(c);a=charIdx>0?a.substring(0,charIdx):a;return a};b=d(d(b,"?"),"#");var f=b.indexOf(e),a=b.substring(f+e.length),g=a.indexOf("/"),c=a.lastIndexOf("/");a=c>=0?a.substring(g,c):a;return a+"/"+h}function j(e,c){var f=c!=null?c:{};if(e!=null){var d=e.split("&");for(var b=0;b<d.length;b++){var a=d[b].split("=");if(a.length==2)f[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}}return f}function hb(b){var d=b.indexOf("?")+1,c=b.indexOf("#")+1,a={};if(d>0){var e=c>d?c-1:b.length;a=j(b.substring(d,e),a)}if(c>0)a=j(b.substring(c),a);return a}var Vf=[p,AK_AUTH_TOKEN,AK_SCOPE,AK_EXPIRES_IN,AK_EXPIRES,AK_REQUEST_TS,AK_ERROR,AK_ERROR_DESC],Df="refresh_type",le="app",Ae="ms",Be="response_method",od="url",Dc="cookie",Ce="onanalytics",Je="login",Nc="loginstatus",I="file_dialog",se="auth.response",n="client-id",gc=".OneDriveSaveButton",Og="file",Jf="click",g="onedrive-js",yd="2px",uc="0px",te="4px",nc="METHOD: Failed to initialize due to missing 'client-id'.",Gc="Loading OneDrive picker is timed out.",Md="mode",zc="open",Bc="save",Ac="read",Zb="readwrite",G="linkType",jc="resourceType",Ob="file",Ib="folder",gd="select",fc="single",kc="multi",tc="permission",Mb="onetime",Hc="lightbox",ec="grey",Gb="transparent",Yb="white",Ub="loading_timeout",sc="onselected",Qd="cancel",de="error",we="file",id="fileName",jd="internal_app",kd=G,Vb="downloadLink",ac="webViewLink",ld="progress",Rd="multiSelect",zd="success",ee="theme",Kc="blue",Cc="white",fg="content_url",ze="data_url",Rf="form",Hb="METHOD: This upload method is not implemented.",Me="{0}: Operation: '{1}' Error message: {2}",Eb="{0}: Invalid response from the file picker. Response: {1}",Rc="API call",pc="invoke picker",Db="unhandled exception",qc="upload",Lb="upload: poll for completion",Nd="OneDrive.open",Od="OneDrive.save",Pb="OneDrive.createOpenButton",Qb="OneDrive.createSaveButton",Bb="OneDriveApp.onloadInit",vc="OneDriveApp.initialize",M="auth",F="rps",rc="oauth",H="v",D="1",Jb="2",L="domain",Wc="livesdk",ce="mkt";FILEDIALOG_PARAM_PICKER_SCRIPT="pickerscript";FILEDIALOG_CHCMD_ONCOMPLETE="onPickerComplete",FILEDIALOG_CHCMD_UPDATETOKEN="updateToken";var xd=104857600,ub=27,yf=1000,Of=5,q="[OneDrive]",jf="skydrivepicker",Dd="@name.conflictBehavior=rename",nd="select=id,@content.downloadUrl,name,size&expand=thumbnails",Rb="select=id,webUrl,name,size&expand=thumbnails,children(select=id,webUrl,name,size;expand=thumbnails)",Sf="select=id",Yd=["large","medium","small"];function r(a,b,c){if(a.addEventListener)a.addEventListener(b,c,false);else if(a.attachEvent)a.attachEvent("on"+b,c)}function nb(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,false);else if(a.detachEvent)a.detachEvent("on"+b,c)}var s={registerOuterChannel:function(f,c,d,e,b){return a.registerChannel(f,c,d,e,b)},registerInnerChannel:function(d,c,b){return a.registerChannel(d,c,null,null,b)},isSupported:function(){return a.isSupported()}},a={_channels:[],isSupported:function(){return window.postMessage!=null},registerChannel:function(i,f,g,h,e){var c=a,d=c._channels,b=null;if(c.isSupported()){b=new m(i,f,g,h,e);if(d.length===0)r(window,"message",c._onMessage);d.push(b)}return b},unregisterChannel:function(e){var d=a,b=d._channels;for(var c=0;c<b.length;c++)if(b[c]==e){b.splice(c,1);break}if(b.length===0)nb(window,"message",d._onMessage)},_onMessage:function(b){var e=a,b=b||window.event,d=lb(b);if(d!=null){var c=e._findChannel(b,d);if(c!=null)switch(d.text){case y:c._onConnectReq(b.source,b.origin);break;case x:c._onConnectAck(b.source);break;default:c._onMessage(d.text)}}},_findChannel:function(h,g){var e=a,d=e._channels,f=qb(h.origin);for(var c=0;c<d.length;c++){var b=d[c];if(i(b._name,g.name)&&i(b._allowedDomain,f))return b}return null}},y="@ConnectReq",x="@ConnectAck";function m(f,d,b,e,c){var a=this;a._name=f;a._allowedDomain=d;a._msgHandler=c;if(b){a._targetWindow=b;a._targetUrl=kb(e);a._connect()}}m.prototype={_disposed:false,_connected:false,_allowedDomain:null,_targetWindow:null,_targetUrl:null,_msgHandler:null,_connectSchedule:-1,_pendingQueue:[],_recvQueue:[],dispose:function(){var b=this;if(!b._disposed){b._disposed=true;b._cancelConnect();a.unregisterChannel(b)}},send:function(c,d){var a=this;if(a._disposed)return;var b=O(c,d);if(a._connected)a._post(b);else a._pendingQueue.push(b)},_connect:function(){var a=this;if(a._disposed||a._connected)return;var b=function(){a._post(y)};if(a._connectSchedule===-1){a._connectSchedule=window.setInterval(b,500);b()}},_post:function(b){var a=this,c=eb(a._name,b);a._targetWindow.postMessage(c,a._targetUrl)},_onConnectReq:function(c,b){var a=this;if(!a._connected){a._connected=true;a._targetWindow=c;a._targetUrl=b;a._post(x);a._onConnected()}},_onConnectAck:function(b){var a=this;if(!a._connected){a._targetWindow=b;a._onConnected()}},_onConnected:function(){var a=this,c=a._pendingQueue;a._connected=true;for(var b=0;b<c.length;b++)a._post(c[b]);a._pendingQueue=[];a._cancelConnect()},_cancelConnect:function(){var a=this;if(a._connectSchedule!=-1){window.clearInterval(a._connectSchedule);a._connectSchedule=-1}},_onMessage:function(b){if(this._msgHandler){var a=N(b);this._msgHandler(a.cmd,a.args)}}};function kb(b){var a=b.indexOf("://");if(a>=0){a=b.indexOf("/",a+3);if(a>=0)b=b.substring(0,a)}return b}function lb(a){var b=null;if(!l(a.origin)&&!l(a.data)&&a.source!=null)b=db(a.data);return b}function eb(a,b){return "<"+a+">"+b}function db(a){var c=null;if(a.charAt(0)=="<"){var b=a.indexOf(">");if(b>0){var d=a.substring(1,b),e=a.substr(b+1);c={name:d,text:e}}}return c}function O(a,c){var b={cmd:a,args:c};return JSON.stringify(b)}function N(b){var a=JSON.parse(b);return a}if(window.WL)wl_app.channel=s;else window.WL={channel:s};WL.skydrivePicker={init:function(a){this._controller=new o(a)}};var o=function(a){this._view=a;this.init()};o.prototype={init:function(){var a=this,c=hb(window.location.href);a._isFolderPicker=c[H]===D;a._rpsAuth=c[M]===F;a._view.subscribe(e(a,a.onSuccess),e(a,a.onFailure));a._channel=WL.channel.registerInnerChannel(I,c[L],e(a,a.onMessage));r(window,"keydown",function(b){if(b.keyCode===ub)a.onFailure()});b("Picker on inited")},onSuccess:function(c){b("The picker process has completed.");var a=this.buildResponse(c);this._channel.send(FILEDIALOG_CHCMD_ONCOMPLETE,a)},onFailure:function(a){b("The picker process is aborted.");var d=S,c=fb;if(a){d=k;c=J;if(a.debugMessage)b("Error: "+a.debugMessage)}var e={error:{code:d,message:c}};this._channel.send(FILEDIALOG_CHCMD_ONCOMPLETE,e)},onMessage:function(a,c){b(a);switch(a){case FILEDIALOG_CHCMD_UPDATETOKEN:if(this._view)this._view.updateToken(c)}},buildResponse:function(a){if(!(a instanceof Array))a=[a];var e=[],f=[],d={data:{}};for(var c=0;c<a.length;c++){var b=this._rpsAuth?T(a[c]):cb(a[c]);if(b.id.indexOf("folder")===0||!!b.folder)e.push(b);else f.push(b)}if(f.length>0)d.data.files=f;if(e.length>0)d.data.folders=e;return d}};function b(a){if(window.console)console.log(a)}function cb(a){var j=a.id,o=a.name,g=a.extension,m=a.ownerCid.toLowerCase(),c=a.urls,b="file",h="file.",i=!!a.folder,d=false,e=null,k=null;if(i){h="folder.";b=a.folder.category===1?"album":"folder";d=j==="root"}else if(a.audio)b="audio";else if(a.video)b="video";else if(a.photo)b="photo";else if((a.itemType&16)===16)b="notebook";var e=h+m+(d?"":"."+j),l=d?"SkyDrive":o+(g?g:""),n=c&&c.viewInBrowser?c.viewInBrowser:null,k=a.folder?"WL_APISERVICE_URL"+e+"/files/":"WL_APISERVICE_URL"+e+"/content/",f={id:e,description:a.caption,name:l,type:b,link:n,upload_location:k};if(!i)f.source=c&&c.download?c.download:null;return f}function T(a){var b=K(a,["id","name","caption","extension","itemType","ownerCid","urls","folder","audio","video","photo","thumbnailSet"]);return b}function K(f,c){var b={};for(var a=0;a<c.length;a++){var d=c[a],e=f[d];if(e!==undefined)b[d]=e}return b}})();